<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Form Submission Demo - Contact Us</title>

    <!-- Bootstrap CSS from CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- reCAPTCHA Enterprise Script -->
    <script src="https://www.google.com/recaptcha/enterprise.js" async defer></script>

    <style>
      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 40px 0;
      }

      .form-container {
        max-width: 600px;
        margin: 0 auto;
        background: white;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        padding: 40px;
      }

      .form-title {
        color: #333;
        font-weight: 700;
        margin-bottom: 10px;
      }

      .form-subtitle {
        color: #666;
        margin-bottom: 30px;
      }

      .field-error {
        color: #dc3545;
        font-size: 0.875rem;
        margin-top: 0.25rem;
        display: none;
      }

      .field-error.show {
        display: block;
      }

      .form-control.is-invalid {
        border-color: #dc3545;
        background-image: none;
      }

      .error-summary {
        display: none;
        background: #f8d7da;
        border: 1px solid #f5c2c7;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
        color: #842029;
      }

      .error-summary.show {
        display: block;
      }

      .error-summary ul {
        margin: 0;
        padding-left: 20px;
      }

      .success-message {
        display: none;
        background: #d1e7dd;
        border: 1px solid #badbcc;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
        color: #0f5132;
      }

      .success-message.show {
        display: block;
      }

      .form-text {
        color: #6c757d;
        font-size: 0.875rem;
        margin-top: 0.25rem;
      }

      .file-input-wrapper {
        position: relative;
      }

      .file-input-label {
        display: inline-block;
        padding: 8px 16px;
        background-color: #e9ecef;
        border: 1px solid #ced4da;
        border-radius: 0.375rem;
        cursor: pointer;
        transition: background-color 0.15s ease-in-out;
      }

      .file-input-label:hover {
        background-color: #dee2e6;
      }

      .file-input-label i {
        margin-right: 8px;
      }

      .file-name-display {
        display: inline-block;
        margin-left: 10px;
        color: #495057;
        font-size: 0.875rem;
      }

      .btn-group-custom {
        display: flex;
        gap: 10px;
        margin-top: 20px;
      }

      .btn-group-custom button {
        flex: 1;
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        padding: 12px 24px;
        font-weight: 600;
      }

      .btn-primary:hover {
        opacity: 0.9;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .btn-secondary {
        background: #6c757d;
        border: none;
        padding: 12px 24px;
        font-weight: 600;
      }

      .loading {
        opacity: 0.6;
        pointer-events: none;
      }

      .spinner-border-sm {
        width: 1rem;
        height: 1rem;
        border-width: 0.2em;
      }

      .honeypot {
        opacity: 0;
        position: absolute;
      }

      .recaptcha-notice {
        font-size: 0.75rem;
        color: #6c757d;
        margin-top: 15px;
        text-align: center;
      }

      .recaptcha-notice a {
        color: #667eea;
      }

      @media (max-width: 576px) {
        .form-container {
          padding: 24px;
          margin: 0 15px;
        }

        .btn-group-custom {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="form-container">
        <h2 class="form-title">Contact Us</h2>
        <p class="form-subtitle">Fill out the form below and we'll get back to you soon.</p>

        <!-- Error Summary -->
        <div class="error-summary" id="errorSummary">
          <strong>Please fix the following errors:</strong>
          <ul id="errorSummaryList"></ul>
        </div>

        <!-- Success Message -->
        <div class="success-message" id="successMessage">
          <strong>Success!</strong>
          <p id="successMessageText" class="mb-0"></p>
        </div>

        <!-- Contact Form -->
        <form
          id="contactForm"
          action="http://localhost:4100/api/submissions/1c01cf5b-3cd0-422e-8944-f409ceb2f219"
          method="POST"
          enctype="multipart/form-data"
        >
          <input type="text" id="subject" name="subject" class="honeypot" />

          <!-- Name Field -->
          <div class="mb-3">
            <label for="name" class="form-label">Name *</label>
            <input type="text" class="form-control" id="name" name="name" placeholder="Enter your full name" required />
            <div class="field-error" data-field="name"></div>
          </div>

          <!-- Email Field -->
          <div class="mb-3">
            <label for="email" class="form-label">Email Address *</label>
            <input type="email" class="form-control" id="email" name="email" placeholder="you@example.com" required />
            <div class="field-error" data-field="email"></div>
          </div>

          <!-- Logo File Upload Field -->
          <div class="mb-3">
            <label for="logo" class="form-label">Company Logo</label>
            <input type="file" class="form-control" id="logo" name="logo" accept="image/*,.pdf" />
            <div class="form-text">
              Upload your company logo (max 10MB). Accepted formats: JPG, PNG, GIF, PDF. Executable files are not
              allowed.
            </div>
            <div class="field-error" data-field="logo"></div>
          </div>

          <!-- Message Field -->
          <div class="mb-3">
            <label for="message" class="form-label">Message *</label>
            <textarea
              class="form-control"
              id="message"
              name="message"
              rows="5"
              placeholder="Tell us how we can help you..."
              required
            ></textarea>
            <div class="field-error" data-field="message"></div>
          </div>

          <!-- Hidden field for reCAPTCHA Enterprise token -->
          <div class="g-recaptcha" data-sitekey="6Ld8_xYsAAAAALaYTnxHOVVleLzxyO4iDNnedXYE" data-action="LOGIN"></div>
          <!-- <input type="hidden" id="g-recaptcha-response" name="g-recaptcha-response" /> -->
          <div class="field-error" data-field="g-recaptcha-response"></div>

          <!-- Submit Buttons -->
          <div class="btn-group-custom">
            <button type="submit" class="btn btn-primary" id="submitNormal">
              <span class="button-text">Submit Normally</span>
              <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
            </button>
            <button type="button" class="btn btn-secondary" id="submitAjax">
              <span class="button-text">Submit via AJAX</span>
              <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
            </button>
          </div>

          <!-- reCAPTCHA Notice -->
          <p class="recaptcha-notice">
            This site is protected by reCAPTCHA Enterprise and the Google
            <a href="https://policies.google.com/privacy" target="_blank">Privacy Policy</a>
            and
            <a href="https://policies.google.com/terms" target="_blank">Terms of Service</a>
            apply.
          </p>
        </form>
      </div>
    </div>

    <!-- Axios from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>

    <!-- FormSubmit Library -->
    <script src="http://localhost:4100/api/scripts/formsubmits-core.js"></script>

    <!-- Initialize Form -->
    <script>
      // reCAPTCHA Enterprise configuration
      var RECAPTCHA_SITE_KEY = '6Ld8_xYsAAAAALaYTnxHOVVleLzxyO4iDNnedXYE';
      var RECAPTCHA_ACTION = 'CONTACT_FORM';

      /**
       * Get reCAPTCHA Enterprise token
       * Returns a Promise that resolves with the token
       */
      function getRecaptchaToken() {
        return new Promise(function (resolve, reject) {
          if (typeof grecaptcha === 'undefined' || typeof grecaptcha.enterprise === 'undefined') {
            reject(new Error('reCAPTCHA Enterprise not loaded'));
            return;
          }

          grecaptcha.enterprise.ready(function () {
            grecaptcha.enterprise
              .execute(RECAPTCHA_SITE_KEY, { action: RECAPTCHA_ACTION })
              .then(function (token) {
                resolve(token);
              })
              .catch(function (error) {
                reject(error);
              });
          });
        });
      }

      document.addEventListener('DOMContentLoaded', function () {
        var form = document.getElementById('contactForm');
        var submitNormalBtn = document.getElementById('submitNormal');
        var submitAjaxBtn = document.getElementById('submitAjax');
        var logoInput = document.getElementById('logo');
        var recaptchaInput = document.getElementById('g-recaptcha-response');

        // Show selected file name
        logoInput.addEventListener('change', function (e) {
          if (this.files && this.files.length > 0) {
            console.log('File selected:', this.files[0].name, 'Size:', this.files[0].size, 'bytes');
          }
        });

        // Initialize the form handler
        var formHandler = new FormSubmissionHandler(form, {
          onSuccess: function (response) {
            console.log('Form submitted successfully:', response);
          },
          onError: function (response) {
            console.log('Form submission failed:', response);
          },
          onBeforeSubmit: function () {
            console.log('Form submission started...');
          },
          onAfterSubmit: function () {
            console.log('Form submission completed.');
          },
        });

        // Enable auto-clearing of errors
        formHandler.enableAutoClearErrors();

        // Handle normal form submission - get token before submit
        form.addEventListener('submit', function (e) {
          e.preventDefault();

          var button = submitNormalBtn;
          var buttonText = button.querySelector('.button-text');
          var spinner = button.querySelector('.spinner-border');

          // Show loading state
          buttonText.textContent = 'Verifying...';
          spinner.classList.remove('d-none');
          button.disabled = true;

          // Get reCAPTCHA token first
          getRecaptchaToken()
            .then(function (token) {
              // Set the token in the hidden field
              recaptchaInput.value = token;
              console.log('reCAPTCHA token obtained:', token.substring(0, 20) + '...');

              // Now submit the form normally
              buttonText.textContent = 'Submitting...';

              // Use the form handler for submission
              formHandler.submitNormal(button);
            })
            .catch(function (error) {
              console.error('reCAPTCHA error:', error);
              buttonText.textContent = 'Submit Normally';
              spinner.classList.add('d-none');
              button.disabled = false;

              // Show error to user
              formHandler.showError('g-recaptcha-response', 'reCAPTCHA verification failed. Please try again.');
            });
        });

        // Handle AJAX submission
        submitAjaxBtn.addEventListener('click', function (e) {
          e.preventDefault();

          var button = submitAjaxBtn;
          var buttonText = button.querySelector('.button-text');
          var spinner = button.querySelector('.spinner-border');

          // Show loading state
          buttonText.textContent = 'Verifying...';
          spinner.classList.remove('d-none');
          button.disabled = true;

          // Get reCAPTCHA token first
          getRecaptchaToken()
            .then(function (token) {
              // Set the token in the hidden field
              recaptchaInput.value = token;
              console.log('reCAPTCHA token obtained:', token.substring(0, 20) + '...');

              // Reset button text before AJAX submission (handler will manage its own state)
              buttonText.textContent = 'Submit via AJAX';
              spinner.classList.add('d-none');
              button.disabled = false;

              // Now submit via AJAX
              formHandler.submitAjax(button);
            })
            .catch(function (error) {
              console.error('reCAPTCHA error:', error);
              buttonText.textContent = 'Submit via AJAX';
              spinner.classList.add('d-none');
              button.disabled = false;

              // Show error to user
              formHandler.showError('g-recaptcha-response', 'reCAPTCHA verification failed. Please try again.');
            });
        });
      });
    </script>
  </body>
</html>
