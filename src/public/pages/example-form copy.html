<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Form Submission Demo - Contact Us</title>

    <!-- Bootstrap CSS from CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- reCAPTCHA Enterprise Script -->
    <script src="https://www.google.com/recaptcha/enterprise.js" async defer></script>

    <style>
      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 40px 0;
      }

      .form-container {
        max-width: 600px;
        margin: 0 auto;
        background: white;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        padding: 40px;
      }

      .form-title {
        color: #333;
        font-weight: 700;
        margin-bottom: 10px;
      }

      .form-subtitle {
        color: #666;
        margin-bottom: 30px;
      }

      .field-error {
        color: #dc3545;
        font-size: 0.875rem;
        margin-top: 0.25rem;
        display: none;
      }

      .field-error.show {
        display: block;
      }

      .form-control.is-invalid {
        border-color: #dc3545;
        background-image: none;
      }

      .error-summary {
        display: none;
        background: #f8d7da;
        border: 1px solid #f5c2c7;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
        color: #842029;
      }

      .error-summary.show {
        display: block;
      }

      .error-summary ul {
        margin: 0;
        padding-left: 20px;
      }

      .success-message {
        display: none;
        background: #d1e7dd;
        border: 1px solid #badbcc;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
        color: #0f5132;
      }

      .success-message.show {
        display: block;
      }

      .form-text {
        color: #6c757d;
        font-size: 0.875rem;
        margin-top: 0.25rem;
      }

      .btn-group-custom {
        display: flex;
        gap: 10px;
        margin-top: 20px;
      }

      .btn-group-custom button {
        flex: 1;
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        padding: 12px 24px;
        font-weight: 600;
      }

      .btn-primary:hover {
        opacity: 0.9;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .btn-secondary {
        background: #6c757d;
        border: none;
        padding: 12px 24px;
        font-weight: 600;
      }

      .spinner-border-sm {
        width: 1rem;
        height: 1rem;
        border-width: 0.2em;
      }

      .honeypot {
        opacity: 0;
        position: absolute;
      }

      .recaptcha-container {
        margin-bottom: 15px;
      }

      .recaptcha-notice {
        font-size: 0.75rem;
        color: #6c757d;
        margin-top: 15px;
        text-align: center;
      }

      .recaptcha-notice a {
        color: #667eea;
      }

      @media (max-width: 576px) {
        .form-container {
          padding: 24px;
          margin: 0 15px;
        }

        .btn-group-custom {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="form-container">
        <h2 class="form-title">Contact Us</h2>
        <p class="form-subtitle">Fill out the form below and we'll get back to you soon.</p>

        <!-- Error Summary -->
        <div class="error-summary" id="errorSummary">
          <strong>Please fix the following errors:</strong>
          <ul id="errorSummaryList"></ul>
        </div>

        <!-- Success Message -->
        <div class="success-message" id="successMessage">
          <strong>Success!</strong>
          <p id="successMessageText" class="mb-0"></p>
        </div>

        <!-- Contact Form -->
        <form
          id="contactForm"
          action="http://localhost:4100/api/submissions/1c01cf5b-3cd0-422e-8944-f409ceb2f219"
          method="POST"
          enctype="multipart/form-data"
        >
          <input type="text" id="subject" name="subject" class="honeypot" />

          <!-- Name Field -->
          <div class="mb-3">
            <label for="name" class="form-label">Name *</label>
            <input type="text" class="form-control" id="name" name="name" placeholder="Enter your full name" required />
            <div class="field-error" data-field="name"></div>
          </div>

          <!-- Email Field -->
          <div class="mb-3">
            <label for="email" class="form-label">Email Address *</label>
            <input type="email" class="form-control" id="email" name="email" placeholder="you@example.com" required />
            <div class="field-error" data-field="email"></div>
          </div>

          <!-- Logo File Upload Field -->
          <div class="mb-3">
            <label for="logo" class="form-label">Company Logo</label>
            <input type="file" class="form-control" id="logo" name="logo" accept="image/*,.pdf" />
            <div class="form-text">
              Upload your company logo (max 10MB). Accepted formats: JPG, PNG, GIF, PDF. Executable files are not
              allowed.
            </div>
            <div class="field-error" data-field="logo"></div>
          </div>

          <!-- Message Field -->
          <div class="mb-3">
            <label for="message" class="form-label">Message *</label>
            <textarea
              class="form-control"
              id="message"
              name="message"
              rows="5"
              placeholder="Tell us how we can help you..."
              required
            ></textarea>
            <div class="field-error" data-field="message"></div>
          </div>

          <!-- reCAPTCHA Enterprise Checkbox Widget -->
          <div class="recaptcha-container">
            <div
              class="g-recaptcha"
              data-sitekey="6Ld8_xYsAAAAALaYTnxHOVVleLzxyO4iDNnedXYE"
              data-action="CONTACT_FORM"
            ></div>
            <div class="field-error" data-field="g-recaptcha-response"></div>
          </div>

          <!-- Submit Buttons -->
          <div class="btn-group-custom">
            <button type="submit" class="btn btn-primary" id="submitNormal">
              <span class="button-text">Submit Normally</span>
              <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
            </button>
            <button type="button" class="btn btn-secondary" id="submitAjax">
              <span class="button-text">Submit via AJAX</span>
              <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
            </button>
          </div>

          <!-- reCAPTCHA Notice -->
          <p class="recaptcha-notice">
            This site is protected by reCAPTCHA Enterprise and the Google
            <a href="https://policies.google.com/privacy" target="_blank">Privacy Policy</a>
            and
            <a href="https://policies.google.com/terms" target="_blank">Terms of Service</a>
            apply.
          </p>
        </form>
      </div>
    </div>

    <!-- Axios from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>

    <!-- FormSubmit Library -->
    <script src="http://localhost:4100/api/scripts/formsubmits-core.js"></script>

    <!-- Initialize Form -->
    <script>
      /**
       * Show error message for a field
       */
      function showFieldError(fieldName, message) {
        var errorDiv = document.querySelector('.field-error[data-field="' + fieldName + '"]');
        if (errorDiv) {
          errorDiv.textContent = message;
          errorDiv.classList.add('show');
        }

        var input = document.querySelector('[name="' + fieldName + '"]');
        if (input) {
          input.classList.add('is-invalid');
        }

        var errorSummary = document.getElementById('errorSummary');
        var errorSummaryList = document.getElementById('errorSummaryList');
        if (errorSummary && errorSummaryList) {
          errorSummaryList.innerHTML = '<li>' + message + '</li>';
          errorSummary.classList.add('show');
        }
      }

      /**
       * Clear error message for a field
       */
      function clearFieldError(fieldName) {
        var errorDiv = document.querySelector('.field-error[data-field="' + fieldName + '"]');
        if (errorDiv) {
          errorDiv.textContent = '';
          errorDiv.classList.remove('show');
        }

        var input = document.querySelector('[name="' + fieldName + '"]');
        if (input) {
          input.classList.remove('is-invalid');
        }

        var errorSummary = document.getElementById('errorSummary');
        if (errorSummary) {
          errorSummary.classList.remove('show');
        }
      }

      /**
       * Get reCAPTCHA response token
       */
      function getRecaptchaResponse() {
        if (typeof grecaptcha !== 'undefined' && typeof grecaptcha.enterprise !== 'undefined') {
          return grecaptcha.enterprise.getResponse();
        }
        return '';
      }

      /**
       * Reset reCAPTCHA widget
       */
      function resetRecaptcha() {
        if (typeof grecaptcha !== 'undefined' && typeof grecaptcha.enterprise !== 'undefined') {
          try {
            grecaptcha.enterprise.reset();
          } catch (e) {
            console.warn('Could not reset reCAPTCHA:', e);
          }
        }
      }

      /**
       * Validate reCAPTCHA before submission
       */
      function validateRecaptcha() {
        clearFieldError('g-recaptcha-response');

        var response = getRecaptchaResponse();
        if (!response) {
          showFieldError('g-recaptcha-response', 'Please complete the reCAPTCHA verification.');
          return false;
        }

        console.log('reCAPTCHA token obtained:', response.substring(0, 20) + '...');
        return true;
      }

      document.addEventListener('DOMContentLoaded', function () {
        var form = document.getElementById('contactForm');
        var submitNormalBtn = document.getElementById('submitNormal');
        var submitAjaxBtn = document.getElementById('submitAjax');
        var logoInput = document.getElementById('logo');

        // Show selected file name
        logoInput.addEventListener('change', function (e) {
          if (this.files && this.files.length > 0) {
            console.log('File selected:', this.files[0].name, 'Size:', this.files[0].size, 'bytes');
          }
        });

        // Initialize the form handler
        var formHandler = new FormSubmissionHandler(form, {
          onSuccess: function (response) {
            console.log('Form submitted successfully:', response);
            resetRecaptcha();
          },
          onError: function (response) {
            console.log('Form submission failed:', response);
            resetRecaptcha();
          },
          onBeforeSubmit: function () {
            console.log('Form submission started...');
          },
          onAfterSubmit: function () {
            console.log('Form submission completed.');
          },
        });

        // Enable auto-clearing of errors
        formHandler.enableAutoClearErrors();

        // Handle normal form submission
        form.addEventListener('submit', function (e) {
          e.preventDefault();

          if (!validateRecaptcha()) {
            return;
          }

          formHandler.submitNormal(submitNormalBtn);
        });

        // Handle AJAX submission
        submitAjaxBtn.addEventListener('click', function (e) {
          e.preventDefault();

          if (!validateRecaptcha()) {
            return;
          }

          formHandler.submitAjax(submitAjaxBtn);
        });
      });
    </script>
  </body>
</html>
